:root {
  --bg: #0b0b10;
  --panel: #121219cc;
  --text: #e8e8ef;
  --muted: #9aa0ab;
  --primary: #1db954;
  --danger: #ff5c5c;
  --radius: 14px;
  --gap: 16px;
  --shadow: 0 10px 30px rgba(0,0,0,.25);
  --overlay: rgba(0,0,0,.5);
  --drawer-w: 380px;
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);

  /* Splash door image (set dynamically too) */
  --door-image: url("assets/A%20closed%20double%20door.png");
}

/* Base */
* { box-sizing: border-box; }
::selection { background: rgba(29,185,84,.35); }

html, body {
  margin: 0; padding: 0; height: 100%;
  color: var(--text);
  background: radial-gradient(1200px 800px at 80% -20%, rgba(29,185,84,.25), rgba(0,0,0,0)), var(--bg);
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
}

/* Splash (double doors) */
#splash {
  position: fixed; inset: 0; z-index: 50;
  background: #000; /* hidden by doors */
  display: grid; place-items: center;
  pointer-events: auto;
  transition: opacity .35s ease;
}
#splash.hidden { opacity: 0; pointer-events: none; visibility: hidden; }

#splash .doors {
  position: absolute; inset: 0;
  overflow: hidden;
}

/* Each door uses the SAME image, sized to 200% width.
   Left door shows left half, right door shows right half.
   This perfectly splits the single image across both panels. */
#splash .door {
  position: absolute; top: 0; bottom: 0; width: 50%;
  background-image: var(--door-image);
  background-repeat: no-repeat;
  background-size: 200% 100%;
  will-change: transform;
  box-shadow: 0 0 60px rgba(0,0,0,.6) inset;
  transition: transform .9s cubic-bezier(.2,.8,.2,1);
}
#splash .door.left {
  left: 0;
  background-position: left center;
  transform: translateX(0);
  border-right: 1px solid rgba(0,0,0,.6);
}
#splash .door.right {
  right: 0;
  background-position: right center;
  transform: translateX(0);
  border-left: 1px solid rgba(0,0,0,.6);
}
/* Center seam (thin shadow line) */
#splash .seam {
  position: absolute; top: 0; bottom: 0; left: 50%;
  width: 2px; transform: translateX(-1px);
  background: linear-gradient(to bottom, rgba(0,0,0,.8), rgba(255,255,255,.08), rgba(0,0,0,.8));
  opacity: .8;
  pointer-events: none;
}

/* Enter button */
#splash .enter {
  position: relative;
  z-index: 2;
  padding: 10px 18px;
  font-weight: 800;
  letter-spacing: .3px;
  backdrop-filter: blur(6px) saturate(140%);
}

/* Opening state */
#splash.open .door.left  { transform: translateX(-102%); }
#splash.open .door.right { transform: translateX(102%); }
#splash.open .seam { opacity: 0; transition: opacity .3s ease .6s; }
/* After doors slide, fade splash container out */
#splash.fading { opacity: 0; pointer-events: none; visibility: hidden; transition: opacity .45s ease .2s; }

/* Reduced motion: just fade */
@media (prefers-reduced-motion: reduce) {
  #splash .door { transition: none; }
  #splash.open .door.left, #splash.open .door.right { transform: none; }
  #splash { transition: opacity .2s ease; }
}

/* Canvas */
#visualizer {
  position: fixed; inset: 0; width: 100%; height: 100dvh;
  display: block; z-index: 0; touch-action: none;
}

/* App chrome */
#app {
  position: relative; z-index: 1; max-width: 1024px;
  margin: 0 auto;
  padding: calc(12px + var(--safe-top)) 24px calc(16px + var(--safe-bottom));
}

header {
  display: flex; align-items: center; justify-content: space-between;
  gap: var(--gap); margin-bottom: 20px;
}

h1 { margin: 0; font-weight: 800; letter-spacing: 0.3px; }
#actions { display: flex; align-items: center; gap: 8px; }
#auth { display: flex; gap: 8px; }

button {
  appearance: none; background: var(--panel); color: var(--text);
  border: 1px solid rgba(255,255,255,.06);
  padding: 10px 14px; border-radius: 999px; cursor: pointer;
  box-shadow: var(--shadow);
  transition: transform .12s ease, filter .12s ease, background .2s ease, opacity .2s ease;
}
button.primary { background: var(--primary); color: #041b0b; border-color: transparent; font-weight: 700; }
button.ghost { background: rgba(255,255,255,.06); border-color: rgba(255,255,255,.1) }
button:hover { filter: brightness(1.06); transform: translateY(-1px); }
button:active { transform: translateY(0); }

#user {
  display: flex; align-items: center; gap: 12px;
  background: rgba(0,0,0,.25); border: 1px solid rgba(255,255,255,.06);
  padding: 10px 12px; border-radius: var(--radius); margin-bottom: 16px;
  backdrop-filter: blur(6px);
}
#user img { width: 36px; height: 36px; border-radius: 50%; object-fit: cover; }
.badge { display: inline-block; padding: 2px 8px; border-radius: 999px; background: rgba(255,255,255,.06); font-size: 12px; margin-top: 2px; }

#player {
  background: rgba(0,0,0,.35); border: 1px solid rgba(255,255,255,.08);
  border-radius: var(--radius); padding: 16px; box-shadow: var(--shadow);
  backdrop-filter: blur(10px) saturate(130%);
}

#track { display: grid; grid-template-columns: 96px 1fr; gap: 14px; align-items: center; }
#album-art { width: 96px; height: 96px; border-radius: 10px; box-shadow: 0 12px 40px rgba(0,0,0,.35); object-fit: cover; }
.meta .title { font-weight: 800; font-size: 18px; }
.meta .subtitle { opacity: .9 }
.meta .muted { color: var(--muted); }

#controls { display: grid; grid-template-columns: auto auto auto 1fr auto; gap: 12px; align-items: center; padding-top: 12px; }
#time { display: grid; grid-template-columns: 48px 1fr 48px; gap: 8px; align-items: center; }
#time input[type="range"] { width: 100%; }
#volume { display: flex; align-items: center; gap: 8px; }

input[type="range"] { width: 100%; accent-color: var(--primary); }

.muted { color: var(--muted); }
.small { font-size: 12px; }
footer { margin-top: 20px; }
#status { margin-top: 6px; }

/* Drawer and overlay (unchanged) */
#overlay {
  position: fixed; inset: 0; background: var(--overlay);
  opacity: 0; pointer-events: none; transition: opacity .2s ease; z-index: 5;
}
#drawer {
  position: fixed; top: 0; right: 0; height: 100dvh; width: min(100%, var(--drawer-w));
  background: rgba(15, 15, 22, .96); border-left: 1px solid rgba(255,255,255,.08);
  box-shadow: -24px 0 60px rgba(0,0,0,.45);
  transform: translateX(100%); transition: transform .28s cubic-bezier(.2,.8,.2,1);
  z-index: 6; padding-bottom: var(--safe-bottom);
  backdrop-filter: blur(16px) saturate(140%); overflow-y: auto;
}
#overlay.open { opacity: 1; pointer-events: auto; }
#drawer.open { transform: translateX(0); }

.drawer-header {
  position: sticky; top: 0; display: flex; align-items: center; justify-content: space-between; gap: 8px;
  padding: calc(10px + var(--safe-top)) 16px 10px;
  background: linear-gradient(to bottom, rgba(0,0,0,.45), rgba(0,0,0,0));
  backdrop-filter: blur(6px); border-bottom: 1px solid rgba(255,255,255,.06);
}
.drawer-section { padding: 12px 16px 4px; }
.drawer-section h3 { margin: 8px 0 10px; }

.field { display: grid; grid-template-columns: 1fr; gap: 6px; margin-bottom: 12px; }
.field label { font-size: 13px; color: var(--muted); }
.field .checkbox { display: flex; align-items: center; gap: 10px; }
.field input[type="color"] { width: 48px; height: 32px; border-radius: 8px; border: 1px solid rgba(255,255,255,.1); background: transparent; }

.row { display: flex; gap: 8px; flex-wrap: wrap; }
.chip {
  border-radius: 999px; padding: 6px 12px; background: rgba(255,255,255,.08);
  border: 1px solid rgba(255,255,255,.12); cursor: pointer;
}
.chip:hover { filter: brightness(1.08); }

/* Mode sections visibility */
.mode-section { display: none; }
.mode-section.active { display: block; }

/* iPhone tweaks */
.iphone #app { padding-left: 16px; padding-right: 16px; }
.iphone button { padding: 10px 16px; }
.iphone #drawer { width: 100%; }

@media (max-width: 640px) {
  #controls { grid-template-columns: auto auto auto 1fr; grid-auto-rows: auto; }
  #volume { grid-column: 1 / -1; justify-self: end; }
}